---
title: "Take-home Exercise 2: DataVis Makeover"
date: "January 23, 2024"
date-modified: "last-modified"
toc: true
execute:
  eval: true
  echo: true
  warning: false
editor: visual
---

# 1. The Task

In this take-home exercise, I have selected a peer's [Take-home Exercise 1](https://isss608-ay2023-24t2-ftj72.netlify.app/take-home_ex/take-home_ex01/take-home_ex01) and will improve on the original visualisation by:

-   critiquing the submission in terms of clarity and aesthetics,

-   providing a sketch for an alternative design using the data visualisation design principles and best practices learned in Lesson 1 and 2, and

-   remaking the original design by using ggplot2, ggplot2 extensions and tidyverse packages.

The dataset used is the Student Questionaire data file downloaded from [PISA 2022](https://www.oecd.org/pisa/data/2022database/), and processed by RStudio `tidyverse` family of packages and visualized by `ggplot2` and its extensions.

# 2. The Set-up

The set-up follows up the same steps carried out by the peer. This segment is kept brief as it is not the focus of the exercise.

## 2.1 Loading R packages

Before we begin, we will first load the necessary R packages, as what was carried out by the peer.

The peer loaded the following R packages - [tidyverse](https://www.tidyverse.org/), [haven](https://haven.tidyverse.org/), [ggplot2](https://ggplot2.tidyverse.org/), [patchwork](https://patchwork.data-imaginist.com/),[ggrepel](https://ggrepel.slowkow.com/),[ggthemes](https://ggplot2.tidyverse.org/reference/ggtheme.html),[hrbrthemes](https://www.rdocumentation.org/packages/hrbrthemes/versions/0.1.0),[dplyr](https://dplyr.tidyverse.org/).

I will further load [ggridges](https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html), [ggdist](https://mjskay.github.io/ggdist/) and [ggpubr](https://rpkgs.datanovia.com/ggpubr/).

The code chunk to load the packages is as follows:

```{r}
pacman::p_load(tidyverse,haven,ggplot2,patchwork,ggrepel,ggthemes,hrbrthemes,dplyr,ggridges,ggdist,ggpubr)
```

## 2.2 Importing the data

‘read_sas()’ of haven was used to import the PISA data into the R environment:

```{r}
#| eval: false
stu_qqq <- read_sas("data/cy08msp_stu_qqq.sas7bdat")
```

The peer then filtered the data by limiting it to Singaporean students and removing columns with uniform values. The code chunk is as follows:

```{r}
#| eval: false
stu_qqq_SG_filtered <- stu_qqq %>%
  filter(CNT == "SGP") %>%
  select_if(function(x) !all(x == x[1]))
```

The data was then exported as a new rds file and read for further analysis

```{r}
#| eval: false
write_rds(stu_qqq_SG_filtered,
          "data/stu_qqq_SG_filtered.rds")
```

```{r}
stu_qqq_SG_filtered <- read_rds("data/stu_qqq_SG_filtered.rds")
```

An overview of the structure of the data is shown below

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## Structure of dataset

```{r}
str(stu_qqq_SG_filtered)
```
:::

# 3. Data Preparation

Data preparation steps taken by the peer are briefly indicated below.

## 3.1 Mean Plausible Value (PV) for all students

The code chunk below obtains the mean of the ten Plausible Values (PV) provided for the subjects of Math, Reading and Science, as an estimate for the student’s performance in the respective subjects.

```{r}
stu_qqq_SG_filtered <- stu_qqq_SG_filtered %>%
  mutate(
    MATH_Score = rowMeans(select(., PV1MATH:PV10MATH), na.rm = TRUE),
    READ_Score = rowMeans(select(., PV1READ:PV10READ), na.rm = TRUE),
    SCIE_Score = rowMeans(select(., PV1SCIE:PV10SCIE), na.rm = TRUE)
  )
```

## 3.2 Mean PV by school {#sect3.2}

The code chunk below obtains the mean Plausible Values (PV) for the subjects of Math, Reading and Science by school ID, as an estimate for the school's performance in the respective subjects.

```{r}
Get_School <- stu_qqq_SG_filtered

By_School <- Get_School %>%
  group_by(CNTSCHID) %>%
  summarize(
    Avg_Math = mean(MATH_Score, na.rm = TRUE),
    Avg_Read = mean(READ_Score, na.rm = TRUE),
    Avg_Scie = mean(SCIE_Score, na.rm = TRUE)
  )
```

## 3.3 Recoding Gender variable

Gender is represented under the variable "ST004D01T" within the dataset, for which responses are written in the form of 1 (Female), and 2 (Male). The peer converted these numeric values to their respective text responses "Female" and "Male" respectively using the code chunk below:

```{r}
stu_qqq_SG_filtered <- stu_qqq_SG_filtered %>%
  mutate(Gender = ifelse(ST004D01T == 1, "Female", "Male"))
```

## 3.4 Changing data type for school ID and student ID

The peer also converted the variable "CNTSCHID" representing school ID from numeric to character data type. I will take the added step of converting the data type of "CNTSTUID" from numeric to character data type using the following code chunk:

```{r}
stu_qqq_SG_filtered <- stu_qqq_SG_filtered %>%
  mutate(CNTSCHID = as.character(CNTSCHID),CNTSTUID = as.character(CNTSTUID))
```

## 3.5 Checks for duplicate data

The peer also carried out a check for duplicate data and determined that there were none.

```{r}
stu_qqq_SG_filtered[duplicated(stu_qqq_SG_filtered),]
```

# 4. Critique and Redesigning Take-home Exercise 1

There were a total of four visualisations in the peer's Take-home exercise and my assessment of their clarity and aesthetics are as follows:

## 4.1 Visualisation 1: PV scores of all students for each subject area

### 4.1.1 Critique

::: panel-tabset
## Math {.unlisted}

```{r,echo=FALSE}
ggplot(data = stu_qqq_SG_filtered,
       aes (x = 1, y = MATH_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Math Scores")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = stu_qqq_SG_filtered,
       aes (x = 1, y = MATH_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Math Scores")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```
:::

## Reading {.unlisted}

```{r,echo=FALSE}
ggplot(data = stu_qqq_SG_filtered,
       aes (x = 1, y = READ_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Reading Scores")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = stu_qqq_SG_filtered,
       aes (x = 1, y = READ_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Reading Scores")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```
:::

## Science {.unlisted}

```{r,echo=FALSE}
ggplot(data = stu_qqq_SG_filtered,
       aes (x = 1, y = SCIE_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Science Scores")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = stu_qqq_SG_filtered,
       aes (x = 1, y = SCIE_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Science Scores")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```
:::
:::

+-----------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Positives                                                                                                             | Negatives                                                                                                                                                                                                                                                                                                                                                                                                                  |
+=======================================================================================================================+============================================================================================================================================================================================================================================================================================================================================================================================================================+
| -   The theme used is appropriate as the graph is visually clean and neat.                                            | -   The title of the chart is too generic, stating just "Math Score", "Reading Score" and "Science Score" without indicating that these are average scores of students. A reader would have to further read the explanation accompanying the visualisation to determine the level of granularity of the data i.e. to check if the visualisation represented scores at the student level or at a more general school level. |
|                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                            |
| -   The mean value is represented as a maroon dot in the boxplot which provides an additional data point for readers. | -   The y-axis representing PV scores is unlabelled as the code includes "axis.title.y = element_blank()".                                                                                                                                                                                                                                                                                                                 |
|                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                                                                                       | -   Based on the [Code Book](https://webfs.oecd.org/pisa2022/CY08MSP_CODEBOOK_5thDecember23.xlsx) provided by OECD, PV scores can range from 0 to 1000 however the y-axis ranges from 100 to 900 which is a misrepresentation.                                                                                                                                                                                             |
|                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                                                                                       | -   Notches in notched boxplots represent confidence intervals around medians, and help readers to visually assess whether medians of distributions differ. If the notched areas do not overlap across boxplots, the medians are different from one another. However, in this case, the plots are too wide and flat, making it difficult to observe the notch.                                                             |
|                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                                                                                       | -   Further, the notch does not serve its purpose for comparison as the plots for Math, Reading and Science are separately indicated in tabsets. One cannot compare across all three subjects at a glance.                                                                                                                                                                                                                 |
+-----------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

### 4.1.2 Sketch of alternative design

<insert diagram>

We will improve the original visualisation by:

-   renaming the title

-   adding in the y-axis label and reset the limits of the y-axis scale to the range of 0 to 1000

-   adding an annotation to label median and removing the notches as the differences between the notches are not clear and the annotation would suffice in indicating the different median values

-   having a side-by-side comparison of all 3 subjects via patchwork

### 4.1.3 Remaking the design

The code chunks for the individual plots are as follows:

::: panel-tabset
## Math {.unlisted}

```{r,fig.align='default'}
p3 <- ggplot(data = stu_qqq_SG_filtered,
       aes(y = MATH_Score)) +
  geom_boxplot(width=0.03)+
  stat_boxplot(geom = "errorbar", width = 0.01) +
  stat_summary(aes(x = 0),
               geom = "point",       
               fun.y = "mean",         
               colour = "maroon", 
               size = 2) +
  geom_text(aes(x=0,y=900,
                label=paste("Median:",median(MATH_Score))),
            vjust=-1,
            hjust=0.5,
            colour="maroon",
            size=3)+
  scale_y_continuous(limits = c(0,1000),breaks = seq(0,1000,by=100)) +
  labs(
    title = "Math Scores",
    y = "Math Scores"
  )+
  theme_hc(base_size=10)+
  theme(aspect.ratio = 3,axis.text.x = element_blank(),axis.line.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank() )
```

## Reading {.unlisted}

```{r,fig.align='default'}
p4 <- ggplot(data = stu_qqq_SG_filtered,
       aes(y = READ_Score)) +
  geom_boxplot(width=0.03)+
  stat_boxplot(geom = "errorbar", width = 0.01) +
  stat_summary(aes(x = 0),
               geom = "point",       
               fun.y = "mean",         
               colour = "blue", 
               size = 2) +
  geom_text(aes(x=0,y=900,
                label=paste("Median:",median(READ_Score))),
            vjust=-1,
            hjust=0.5,
            colour="blue",
            size=3)+
  scale_y_continuous(limits = c(0,1000),breaks = seq(0,1000,by=100)) +
  labs(
    title = "Reading Scores",
    y = "Reading Scores"
  )+
  theme_hc(base_size = 10)+
  theme(aspect.ratio = 3,axis.text.x = element_blank(),axis.line.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank())
```

## Science {.unlisted}

```{r,fig.align='default'}
p5 <- ggplot(data = stu_qqq_SG_filtered,
       aes(y = SCIE_Score)) +
  geom_boxplot(width=0.03)+
  stat_boxplot(geom = "errorbar", width = 0.01) +
  stat_summary(aes(x = 0),
               geom = "point",       
               fun.y = "mean",         
               colour = "orange", 
               size = 2) +
  geom_text(aes(x=0,y=900,
                label=paste("Median:",median(SCIE_Score))),
            vjust=-1,
            hjust=0.5,
            colour="orange",
            size=3)+
  scale_y_continuous(limits = c(0,1000),breaks = seq(0,1000,by=100)) +
  labs(
    title = "Science Scores",
    y = "Science Scores"
  )+
  theme_hc(base_size = 10)+
  theme(aspect.ratio = 3,axis.text.x = element_blank(),axis.line.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank())
```
:::

The code chunk to visualise all 3 plots side-by-side is as follows:

```{r,fig.align='default'}
(p3|p4|p5)+
  plot_annotation(
  title = "Distribution of scores of all students")
```

This visualisation enables better comparison of student performance across all three subjects. From the above, we can understand that students perform better in Math, followed by Science and lastly reading.

## 4.2 Visualisation 2: PV scores of all students by gender

### 4.2.1 Critique

::: panel-tabset
## Math {.unlisted}

```{r,echo=FALSE}
ggplot(data = stu_qqq_SG_filtered,
       aes (x = Gender, y = MATH_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Math Scores by Gender")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = stu_qqq_SG_filtered,
       aes (x = Gender, y = MATH_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Math Scores by Gender")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```
:::

## Reading {.unlisted}

```{r,echo=FALSE}
ggplot(data = stu_qqq_SG_filtered,
       aes (x = Gender, y = READ_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Reading Scores by Gender")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = stu_qqq_SG_filtered,
       aes (x = Gender, y = READ_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Reading Scores by Gender")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```
:::

## Science {.unlisted}

```{r,echo=FALSE}
ggplot(data = stu_qqq_SG_filtered,
       aes (x = Gender, y = SCIE_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Science Scores by Gender")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = stu_qqq_SG_filtered,
       aes (x = Gender, y = SCIE_Score))+
  geom_boxplot(notch=TRUE)+
  stat_summary(geom = "point", fun.y= "mean", colour ="maroon", size=2)+
  ggtitle("Science Scores by Gender")+
  theme_hc()+
  coord_cartesian(ylim = c(100, 900))+
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```
:::
:::

+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Positives                                                                                                                                                                          | Negatives                                                                                                                                                                                                                                                                                                                                                                                                             |
+====================================================================================================================================================================================+=======================================================================================================================================================================================================================================================================================================================================================================================================================+
| -   The graph is visually clean and neat.                                                                                                                                          | -   The y-axis representing PV scores is unlabelled as the code includes "axis.title.y = element_blank()".                                                                                                                                                                                                                                                                                                            |
|                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
| -   The mean value is represented as a maroon dot in the boxplot which provides an additional data point for readers.                                                              | -   Based on the [Code Book](https://webfs.oecd.org/pisa2022/CY08MSP_CODEBOOK_5thDecember23.xlsx) provided by OECD, PV scores can range from 0 to 1000 however the y-axis ranges from 100 to 900 which is a misrepresentation.                                                                                                                                                                                        |
|                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
| -   Side-by-side comparison of male vs female for each subject                                                                                                                     | -   Boxplots for female and male are coloured the same in black - it is not visually intuitive and one would need to read the labels to determine which results were for which gender.                                                                                                                                                                                                                                |
|                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
| -   The notches help readers to visually assess if the medians of the distributions differ. In this case, medians for female and male appear to be different for Math and Reading. | -   While the notches in notched boxplots help readers to visually assess that the medians of distributions differ between male and female for Math and Reading, it is less clear for Science due to the plots being wide and flat.                                                                                                                                                                                   |
|                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                                                                                                                                    | -   The plots for each subject are placed in individual tabs and one cannot compare across all three subjects at a glance. The visualisation does not allow readers to see and agree with the peer's insight which states "When looking at gender differences, the performance of female and male students appear to be equal in all subjects but reading wherein female students slightly outperform male students." |
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

### 4.2.2 Sketch of alternative design

We will improve the original visualisation by:

-   adding in the proper axis labels and reset the limits of the scale representing scores to the range of 0 to 1000

-   colour the boxplot by gender

-   enhancing the boxplot by creating a raincloud plot to provide more granularity to the data i.e. an understanding of the spread of the data

-   having a side-by-side comparison of all 3 subjects via patchwork

### 4.2.3 Remaking the design

The code chunks for the individual plots are as follows:

::: panel-tabset
## Math {.unlisted}

```{r,fig.height=35,fig.width=30}
p6 <- ggplot(data = stu_qqq_SG_filtered,
       aes (x = Gender, y = MATH_Score, fill = Gender,alpha=0.5))+
  geom_boxplot(notch=TRUE,
               width = 0.1,
               position = position_nudge(x=0.06))+
  stat_halfeye(adjust = 0.8,
               width = 0.3,
               justification = -0.5,
               .width = 0,
               point_colour = NA,
               position = "dodge",
               scale=0.9) +
  stat_dots(side = "left", 
            justification = 1, 
            binwidth = .5,
            dotsize = 10) +
  stat_summary(geom = "point", fun.y= "mean", colour ="black", size=8,position=position_nudge(x=0.06))+
  labs(title = "Math Scores by Gender",
       y = "Math Score",
       x = "Gender")+
  theme_hc(base_size = 30)+
  theme(legend.position = "right")+
  guides(alpha="none")+
  coord_cartesian(ylim = c(0, 1000))+
  scale_y_continuous(limits = c(0,1000),breaks = seq(0, 1000, by = 100))+
  coord_flip()
```

## Reading {.unlisted}

```{r,fig.height=35,fig.width=30}
p7 <- ggplot(data = stu_qqq_SG_filtered,
       aes (x = Gender, y = READ_Score, fill = Gender,alpha=0.5))+
  geom_boxplot(notch=TRUE,
               width = 0.1,
               position = position_nudge(x=0.06))+
  stat_halfeye(adjust = 0.8,
               width = 0.3,
               justification = -0.5,
               .width = 0,
               point_colour = NA,
               position = "dodge",
               scale=0.9) +
  stat_dots(side = "left", 
            justification = 1, 
            binwidth = .5,
            dotsize = 10) +
  stat_summary(geom = "point", fun.y= "mean", colour ="black", size=8,position=position_nudge(x=0.06))+
  labs(title = "Reading Scores by Gender",
       y = "Reading Score",
       x = "Gender")+
  theme_hc(base_size = 30)+
  theme(legend.position = "right")+
  guides(alpha="none")+
  coord_cartesian(ylim = c(0, 1000))+
  scale_y_continuous(limits = c(0,1000),breaks = seq(0, 1000, by = 100))+
  coord_flip()
```

## Science {.unlisted}

```{r,fig.height=35,fig.width=30}
p8 <- ggplot(data = stu_qqq_SG_filtered,
       aes (x = Gender, y = SCIE_Score, fill = Gender,alpha=0.5))+
  geom_boxplot(notch=TRUE,
               width = 0.1,
               position = position_nudge(x=0.06))+
  stat_halfeye(adjust = 0.8,
               width = 0.3,
               justification = -0.5,
               .width = 0,
               point_colour = NA,
               position = "dodge",
               scale=0.9) +
  stat_dots(side = "left", 
            justification = 1, 
            binwidth = .5,
            dotsize = 10) +
  stat_summary(geom = "point", fun.y= "mean", colour = "black", size=8,position=position_nudge(x=0.06))+
  labs(title = "Science Scores by Gender",
       y = "Science Score",
       x = "Gender")+
  theme_hc(base_size = 30)+
  theme(legend.position="right")+
  guides(alpha="none")+
  coord_cartesian(ylim = c(0, 1000))+
  scale_y_continuous(limits = c(0,1000),breaks = seq(0, 1000, by = 100))+
  coord_flip()
```
:::

The code chunk to visualise plots for all 3 subjects is as follows:

```{r,fig.height=35,fig.width=30}
(p6/p7/p8)+
  plot_annotation(tag_levels = 'I')
```

This visualisation allows us to better observe how each gender performs in each subject area, through the median and mean indicated on the boxplot but also through the density plots. The colours used also intuitively indicates which gender we are referring to without the actual need of referring to the legend.

For instance, we observe that the density of results for males is skewed more to the right for Math and Science but more to the left for Reading, as compared to females. This is corroborated by the position of the median and mean on the boxplot. This indicates that males fair better in Math and Science but poorer in Reading as compared to females.

## 4.3 Visualisation 3: Average Scores by School for each subject

### 4.3.1 Critique

::: panel-tabset
## Math {.unlisted}

```{r,echo=FALSE}
ggplot(data = By_School,
       aes(x = factor(1), y = Avg_Math)) +
  geom_boxplot(notch = TRUE) +
  stat_summary(geom = "point", fun.y = "mean", colour = "maroon", size = 2) +
  ggtitle("Math Scores by School") +
  theme_hc() +
  coord_cartesian(ylim = c(300, 750)) +
  scale_y_continuous(breaks = seq(300, 750, by = 50)) +
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = By_School,
       aes(x = factor(1), y = Avg_Math)) +
  geom_boxplot(notch = TRUE) +
  stat_summary(geom = "point", fun.y = "mean", colour = "maroon", size = 2) +
  ggtitle("Math Scores by School") +
  theme_hc() +
  coord_cartesian(ylim = c(300, 750)) +
  scale_y_continuous(breaks = seq(300, 750, by = 50)) +
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```
:::

## Reading {.unlisted}

```{r,echo=FALSE}
ggplot(data = By_School,
       aes(x = factor(1), y = Avg_Read)) +
  geom_boxplot(notch = TRUE) +
  stat_summary(geom = "point", fun.y = "mean", colour = "maroon", size = 2) +
  ggtitle("Reading Scores by School") +
  theme_hc() +
  coord_cartesian(ylim = c(300, 750)) +
  scale_y_continuous(breaks = seq(300, 750, by = 50)) +
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = By_School,
       aes(x = factor(1), y = Avg_Read)) +
  geom_boxplot(notch = TRUE) +
  stat_summary(geom = "point", fun.y = "mean", colour = "maroon", size = 2) +
  ggtitle("Reading Scores by School") +
  theme_hc() +
  coord_cartesian(ylim = c(300, 750)) +
  scale_y_continuous(breaks = seq(300, 750, by = 50)) +
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```
:::

## Science {.unlisted}

```{r,echo=FALSE}
ggplot(data = By_School,
       aes(x = factor(1), y = Avg_Scie)) +
  geom_boxplot(notch = TRUE) +
  stat_summary(geom = "point", fun.y = "mean", colour = "maroon", size = 2) +
  ggtitle("Science Scores by School") +
  theme_hc() +
  coord_cartesian(ylim = c(300, 750)) +
  scale_y_continuous(breaks = seq(300, 750, by = 50)) +
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = By_School,
       aes(x = factor(1), y = Avg_Scie)) +
  geom_boxplot(notch = TRUE) +
  stat_summary(geom = "point", fun.y = "mean", colour = "maroon", size = 2) +
  ggtitle("Science Scores by School") +
  theme_hc() +
  coord_cartesian(ylim = c(300, 750)) +
  scale_y_continuous(breaks = seq(300, 750, by = 50)) +
  theme(axis.text.x = element_blank(),axis.ticks.x = element_blank(),axis.title.x = element_blank(),axis.title.y = element_blank())
```
:::
:::

+-----------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Positives                                                                                                             | Negatives                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
+=======================================================================================================================+====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
| -   The graph is visually clean and neat.                                                                             | -   The y-axis representing PV scores is unlabelled as the code includes “axis.title.y = element_blank()”.                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| -   The mean value is represented as a maroon dot in the boxplot which provides an additional data point for readers. | -   Based on the [Code Book](https://webfs.oecd.org/pisa2022/CY08MSP_CODEBOOK_5thDecember23.xlsx) provided by OECD, PV scores can range from 0 to 1000 however the y-axis ranges from 300 to 750 which is a misrepresentation.                                                                                                                                                                                                                                                                                                                     |
|                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                                                                                                                       | -   Notches in notched boxplots are meant to help readers to visually assess whether medians of distributions differ. If the notched areas do not overlap across boxplots, the medians are different from one another. However, in this case, the notch does not serve its purpose for comparison as the plots for Math, Reading and Science are separately indicated in tabsets. One cannot compare across all three subjects at a glance.                                                                                                        |
|                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                                                                                                                       | -   Further, the visualisation also does not allow for an overall understanding of a school's performance i.e. whether the school consistently performs poorer in all subjects or only for certain subjects. It does not allow one to understand data patterns within the school i.e. spread of scores within each school which could be reflective of characteristics such as the effectiveness of school's methodology i.e. if the school's teaching methodology is effective for most students, there should be a smaller variation in results. |
+-----------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

### 4.3.2 Sketch of alternative design

As stated in [section 3.2](#sect3.2), the peer had created a dataframe *By_School* which includes the school ID and the average Math, Reading and Science scores for each school.

Given this dataframe, we will improve the original visualisation by:

-   adding in the y-axis label and reset the limits of the y-axis scale to the range of 0 to 1000

-   adding annotation to mark the median and corresponding value

-   enhancing the boxplot by adding a density plot to provide more granularity to the data i.e. better understanding of the spread of the data

-   having a side-by-side comparison of all 3 subjects via patchwork

### 4.3.3 Remaking the design

The code chunks for the individual plots are as follows:

::: panel-tabset
## Math {.unlisted}

```{r}
p9 <- ggplot(data = By_School,
       aes(y = Avg_Math)) +
  geom_boxplot(notch = TRUE,
               width=0.3,
               colour="midnightblue",
               lwd=2) +
  stat_halfeye(adjust = .5,
               justification = -0.1,
               .width = 0,
               width = 3,
               point_colour = NA,
               fill="midnightblue",
               alpha=0.5)+
  stat_summary(aes(x=0),geom = "point", fun.y = "mean", colour = "black", size = 5)+
  stat_summary(aes(x = 0), geom = "text", fun.y = "median", 
               label = paste("Median:", round(median(By_School$Avg_Math), 2)),
               hjust = -0.45, vjust = -0.4, color = "midnightblue", size = 10)+
  labs(title="Math Score across schools",y = "Math Score")+
  coord_cartesian(ylim = c(0, 1000)) +
  scale_y_continuous(limits=c(0,1000),breaks = seq(0, 1000, by = 100)) +
  coord_flip()+
  theme_hc(base_size=30)+
  theme(axis.text.y = element_blank(),axis.ticks.y = element_blank(),axis.title.y = element_blank(),aspect.ratio = 1/3)
```

## Reading {.unlisted}

```{r}
p10 <- ggplot(data = By_School,
       aes(y = Avg_Read)) +
  geom_boxplot(notch = TRUE,
               width=0.3,
               colour="mediumvioletred",
               lwd=2) +
  stat_halfeye(adjust = .5,
               justification = -0.1,
               .width = 0,
               width = 3,
               point_colour = NA,
               fill="mediumvioletred",
               alpha=0.5)+
  stat_summary(aes(x=0),geom = "point", fun.y = "mean", colour = "black", size = 5)+
  stat_summary(aes(x = 0), geom = "text", fun.y = "median", 
               label = paste("Median:", round(median(By_School$Avg_Read), 2)),
               hjust = -0.45, vjust = -0.4, color = "mediumvioletred", size = 10)+
  labs(title="Reading Score across schools",y = "Reading Score")+
  coord_cartesian(ylim = c(0, 1000)) +
  scale_y_continuous(limits=c(0,1000),breaks = seq(0, 1000, by = 100)) +
  coord_flip()+
  theme_hc(base_size = 30)+
  theme(axis.text.y = element_blank(),axis.ticks.y = element_blank(),axis.title.y = element_blank(),aspect.ratio = 1/3)
```

## Science {.unlisted}

```{r}
p11 <- ggplot(data = By_School,
       aes(y = Avg_Scie)) +
  geom_boxplot(notch = TRUE,
               width=0.3,
               colour="seagreen3",
               lwd=2) +
  stat_halfeye(adjust = .5,
               justification = -0.1,
               .width = 0,
               width = 3,
               point_colour = NA,
               fill="seagreen3",
               alpha=0.5)+
  stat_summary(aes(x=0),geom = "point", fun.y = "mean", colour = "black", size = 5)+
  stat_summary(aes(x = 0), geom = "text", fun.y = "median", 
               label = paste("Median:", round(median(By_School$Avg_Scie), 2)),
               hjust = -0.45, vjust = -0.4, color = "seagreen3", size = 10)+
  labs(title="Science Score across schools",y = "Science Score")+
  coord_cartesian(ylim = c(0, 1000)) +
  scale_y_continuous(limits=c(0,1000),breaks = seq(0, 1000, by = 100)) +
  coord_flip()+
  theme_hc(base_size=30)+
  theme(axis.text.y = element_blank(),axis.ticks.y = element_blank(),axis.title.y = element_blank(),aspect.ratio = 1/3)
```
:::

We then combine all 3 plots into one visualisation using the following code chunk:

```{r,fig.width=30,fig.height=30}
(p9/p10/p11)+
  plot_annotation(tag_levels = 'I')
```

The above visualisation allows us to better compare the performance of schools across all 3 subjects. At the school level, Math is the best performing subject, followed by Science and lastly Reading. The plots also indicate that there is considerable variability in the performance levels across different schools in all 3 subjects.

However the visualisation still does not provide greater granularity into understanding a school's performance i.e. we are currently unable to visualise and compare each school's performance in all 3 subjects and the spread of results within each school. As such, the above visualisation could be supplemented by another visualisation, a ridgeline plot, which makes use of the larger data set *stu_qqq_SG_filtered* instead of the smaller sub-dataset *By_School*, and provides more details about the spread of performance within each school and each school's performance across subjects:

### 4.3.4 Supplementary visualisation for performance across schools

::: panel-tabset
## Math {.unlisted}

```{r,fig.width=20,fig.height=250}
p12 <- ggplot(stu_qqq_SG_filtered,
       aes(x = MATH_Score, 
           y = CNTSCHID, 
           fill = 0.5 - abs(0.5-stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", 
                      calc_ecdf = TRUE) +
  scale_fill_viridis_c(name = "Tail probability",
                       direction = -1,
                       option="turbo") +
  coord_cartesian(xlim = c(0,1000))+
  theme_ridges()+
  theme(text = element_text(size = 20),axis.title = element_text(size = 20),axis.text=element_text(size=20),legend.key.size = unit(2, 'cm'),plot.title = element_text(size = 20))+
  labs(title="Distribution of Math Scores of students for each school",
       y="School ID",
       x="Math Scores")
```

## Reading {.unlisted}

```{r,fig.width=20,fig.height=250}
p13 <- ggplot(stu_qqq_SG_filtered,
       aes(x = READ_Score, 
           y = CNTSCHID, 
           fill = 0.5 - abs(0.5-stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", 
                      calc_ecdf = TRUE) +
  scale_fill_viridis_c(name = "Tail probability",
                       direction = -1,
                       option="mako") +
  coord_cartesian(xlim = c(0,1000))+
  theme_ridges()+
  theme(text = element_text(size = 20),axis.title = element_text(size = 20),axis.text=element_text(size=20),legend.key.size = unit(2, 'cm'),plot.title = element_text(size = 20))+
  labs(title="Distribution of Reading Scores of students for each school",
       y="School ID",
       x="Reading Scores")
```

## Science {.unlisted}

```{r,fig.width=20,fig.height=250}
p14 <- ggplot(stu_qqq_SG_filtered,
       aes(x = SCIE_Score, 
           y = CNTSCHID, 
           fill = 0.5 - abs(0.5-stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", 
                      calc_ecdf = TRUE) +
  scale_fill_viridis_c(name = "Tail probability",
                       direction = -1,
                       option="plasma") +
  coord_cartesian(xlim = c(0,1000))+
  theme_ridges()+
  theme(text = element_text(size = 20),axis.title = element_text(size = 20),axis.text=element_text(size=20),legend.key.size = unit(2, 'cm'),plot.title = element_text(size = 20))+
  labs(title="Distribution of Science Scores of students for each school",
       y="School ID",
       x="Science Scores")
```
:::

We combine all 3 plots together using the following code chunk:

```{r,fig.width=30,fig.height=80}
p12|p13|p14
```

This visualisation enables a more detailed comparison of performance across schools and within schools - it allows us to understand whether a school consistently performs better/poorer in all subjects or selectively better/poorer in certain subjects - for instance, we observe that schools 702000001 and 702000003 consistently perform better than other schools in all 3 subjects, while schools 702000115 and 702000149 perform consistently poorer.

We can also observe the spread of results within a school for each subject - schools with ridgeline plots that have flatter peaks aka a wider spread indicate more variability in the results. This larger spread could be attributed to various reasons i.e. that the school comprise students from a wide range of backgrounds and learning abilities or that varying teaching methodologies are used within the school hence leading to varying results. This will require further investigation.

## 4.4 Visualisation 4: Scores per subject based on the student’s food security

### 4.4.1 Critique

::: panel-tabset
## Math {.unlisted}

```{r,echo=FALSE}
ggplot(data = stu_qqq_SG_filtered,
       aes(x=ESCS,y=MATH_Score))+
  geom_point()+
  geom_smooth(method=lm,
              size=0.5)+
  ggtitle("Math Score by ESCS") +
  theme_hc() +
  coord_cartesian(ylim = c(100, 900)) +
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = stu_qqq_SG_filtered,
       aes(x=ESCS,y=MATH_Score))+
  geom_point()+
  geom_smooth(method=lm,
              size=0.5)+
  ggtitle("Math Score by ESCS") +
  theme_hc() +
  coord_cartesian(ylim = c(100, 900)) +
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.title.y = element_blank())
```
:::

## Reading {.unlisted}

```{r,echo=FALSE}
ggplot(data = stu_qqq_SG_filtered,
       aes(x=ESCS,y=READ_Score))+
  geom_point()+
  geom_smooth(method=lm,
              size=0.5)+
  ggtitle("Reading Score by ESCS") +
  theme_hc() +
  coord_cartesian(ylim = c(100, 900)) +
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = stu_qqq_SG_filtered,
       aes(x=ESCS,y=READ_Score))+
  geom_point()+
  geom_smooth(method=lm,
              size=0.5)+
  ggtitle("Reading Score by ESCS") +
  theme_hc() +
  coord_cartesian(ylim = c(100, 900)) +
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.title.y = element_blank())
```
:::

## Science {.unlisted}

```{r,echo=FALSE}
ggplot(data = stu_qqq_SG_filtered,
       aes(x=ESCS,y=SCIE_Score))+
  geom_point()+
  geom_smooth(method=lm,
              size=0.5)+
  ggtitle("Science Score by ESCS") +
  theme_hc() +
  coord_cartesian(ylim = c(100, 900)) +
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.title.y = element_blank())
```

::: {.callout-note collapse="true" icon="false" appearance="minimal"}
## The Code {.unlisted}

```{r}
#| eval: false
ggplot(data = stu_qqq_SG_filtered,
       aes(x=ESCS,y=SCIE_Score))+
  geom_point()+
  geom_smooth(method=lm,
              size=0.5)+
  ggtitle("Science Score by ESCS") +
  theme_hc() +
  coord_cartesian(ylim = c(100, 900)) +
  scale_y_continuous(breaks = seq(100, 900, by = 100))+
  theme(axis.title.y = element_blank())
```
:::
:::

+----------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Positives                                                                                                                  | Negatives                                                                                                                                                                                                                                                                                                                                                   |
+============================================================================================================================+=============================================================================================================================================================================================================================================================================================================================================================+
| -   The plot clearly shows a positive relationship between subject scores (Math, Reading and Science) with the ESCS index. | -   The plots are not visually appealing due to the mass of data points in the middle of the plot.                                                                                                                                                                                                                                                          |
|                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                             |
|                                                                                                                            | -   The y-axis representing PV scores is unlabelled as the code includes “axis.title.y = element_blank()”.                                                                                                                                                                                                                                                  |
|                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                             |
|                                                                                                                            | -   Based on the [Code Book](https://webfs.oecd.org/pisa2022/CY08MSP_CODEBOOK_5thDecember23.xlsx) provided by OECD, PV scores can range from 0 to 1000 however the y-axis ranges from 100 to 900 which is a misrepresentation. The ESCS index ranges from -6.84 to 7.38 however the x-axis ticks only indicate -2 to 2 which could be easily misintepreted. |
|                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                             |
|                                                                                                                            | -   The plots for Math, Reading and Science are separately indicated in tabsets. One cannot compare across all three subjects at a glance.                                                                                                                                                                                                                  |
|                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                             |
|                                                                                                                            | -   The plots are not labelled with annotations to indicate the r2 value, which would be helpful in understanding the degree to which the variation in the subject scores could be explained by the variation in the ESCS index.                                                                                                                            |
+----------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

### 4.4.2 Sketch of alternative design

We will start by working off the original visualisation and taking the following steps to improve it:

-   adding in the y-axis label and reset the limits of the y-axis scale to the range of 0 to 1000

-   adding vlines to the plot to indicate the value of Singapore's ESCS index at the 0, 25th, 50th, 75th and 100th percentile. This is with reference to the notes indicated in the [PISA 2022 Results (Volume 1)](https://www.oecd-ilibrary.org/sites/53f23881-en/index.html?itemId=/content/publication/53f23881-en#:~:text=Singapore%20scored%20significantly%20higher%20than,countries%20and%20economies%20in%20mathematics.) where it was stated that ESCS refers to the PISA index of economic, social and cultural status and that a socio-economically advantaged (disadvantaged) student is a student in the **top (bottom) quarter of ESCS in his or her own country/economy**. It would hence be useful to indicate the ESCS index values of Singapore by percentiles.

-   having a side-by-side comparison of all 3 subjects via patchwork

### 4.4.3 Remaking the design

The code chunks for the individual plots are as follows:

::: panel-tabset
## Math {.unlisted}

```{r,fig.width=8,fig.height=5}
p15 <- ggplot(data = stu_qqq_SG_filtered,
       aes(x=ESCS,y=MATH_Score))+
  geom_point(alpha=0.4,color="black")+
  geom_smooth(method=lm,
              size=1,
              colour="mediumblue",
              se=FALSE)+
  labs(title="Math Score by ESCS",
       y="Math Score",
       x="ESCS index")+
  theme_hc() +
  coord_cartesian(ylim = c(0, 1000)) +
  scale_y_continuous(breaks = seq(0, 1000, by = 100))+
  scale_x_continuous(limits = range(stu_qqq_SG_filtered$ESCS)) +
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0,na.rm=TRUE),
             linetype = "dashed", color = "coral2", size = 0.8,label="0%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0, na.rm = TRUE)+0.5, y = 1000, size=3,label = paste("0%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0, na.rm = TRUE), 2)),color="coral2")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0.25,na.rm=TRUE),
             linetype = "dashed", color = "violetred2", size = 0.8,label="25%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0.25, na.rm = TRUE)-0.5, y = 1000, size=3,label = paste("25%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0.25, na.rm = TRUE), 2)),color="violetred2")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0.5,na.rm=TRUE),
             linetype = "dashed", color = "turquoise2", size = 0.8,label="50%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0.5, na.rm = TRUE), y = 1000, size=3,label = paste("50%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0.5, na.rm = TRUE), 2)),color="turquoise2")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0.75,na.rm=TRUE),
             linetype = "dashed", color = "purple", size = 0.8,label="75%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0.75, na.rm = TRUE)+0.4, y = 1000, size=3,label = paste("75%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0.75, na.rm = TRUE), 2)),color="purple")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 1,na.rm=TRUE),
             linetype = "dashed", color = "orange", size = 0.8,label="100%")+
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 1, na.rm = TRUE)-0.5, y = 1000, size=3,label = paste("100%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 1, na.rm = TRUE), 2)),color="orange")+
  stat_cor(aes(label = paste(..rr.label..,..p.label.., sep = "~`,`~")),
           label.x = 2.2, label.y = 800, label.size = 4) +
  theme(axis.title.y = element_blank())
```

## Reading {.unlisted}

```{r,fig.width=8,fig.height=5}
p16 <- ggplot(data = stu_qqq_SG_filtered,
       aes(x=ESCS,y=READ_Score))+
  geom_point(alpha=0.4,color="black")+
  geom_smooth(method=lm,
              size=1,
              colour="mediumblue",
              se=FALSE)+
  labs(title="Reading Score by ESCS",
       y="Reading Score",
       x="ESCS index")+
  theme_hc() +
  coord_cartesian(ylim = c(0, 1000)) +
  scale_y_continuous(breaks = seq(0, 1000, by = 100))+
  scale_x_continuous(limits = range(stu_qqq_SG_filtered$ESCS)) +
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0,na.rm=TRUE),
             linetype = "dashed", color = "coral2", size = 0.8,label="0%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0, na.rm = TRUE)+0.5, y = 1000, size=3,label = paste("0%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0, na.rm = TRUE), 2)),color="coral2")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0.25,na.rm=TRUE),
             linetype = "dashed", color = "violetred2", size = 0.8,label="25%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0.25, na.rm = TRUE)-0.5, y = 1000, size=3,label = paste("25%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0.25, na.rm = TRUE), 2)),color="violetred2")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0.5,na.rm=TRUE),
             linetype = "dashed", color = "turquoise2", size = 0.8,label="50%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0.5, na.rm = TRUE), y = 1000, size=3,label = paste("50%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0.5, na.rm = TRUE), 2)),color="turquoise2")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0.75,na.rm=TRUE),
             linetype = "dashed", color = "purple", size = 0.8,label="75%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0.75, na.rm = TRUE)+0.4, y = 1000, size=3,label = paste("75%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0.75, na.rm = TRUE), 2)),color="purple")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 1,na.rm=TRUE),
             linetype = "dashed", color = "orange", size = 0.8,label="100%")+
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 1, na.rm = TRUE)-0.5, y = 1000, size=3,label = paste("100%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 1, na.rm = TRUE), 2)),color="orange")+
  stat_cor(aes(label = paste(..rr.label..,..p.label.., sep = "~`,`~")),
           label.x = 2.2, label.y = 800, label.size = 4) +
  theme(axis.title.y = element_blank())
```

## Science {.unlisted}

```{r,fig.width=8,fig.height=5}
p17 <- ggplot(data = stu_qqq_SG_filtered,
       aes(x=ESCS,y=SCIE_Score))+
  geom_point(alpha=0.4,color="black")+
  geom_smooth(method=lm,
              size=1,
              colour="mediumblue",
              se=FALSE)+
  labs(title="Science Score by ESCS",
       y="Science Score",
       x="ESCS index")+
  theme_hc() +
  coord_cartesian(ylim = c(0, 1000)) +
  scale_y_continuous(breaks = seq(0, 1000, by = 100))+
  scale_x_continuous(limits = range(stu_qqq_SG_filtered$ESCS)) +
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0,na.rm=TRUE),
             linetype = "dashed", color = "coral2", size = 0.8,label="0%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0, na.rm = TRUE)+0.5, y = 1000, size=3,label = paste("0%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0, na.rm = TRUE), 2)),color="coral2")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0.25,na.rm=TRUE),
             linetype = "dashed", color = "violetred2", size = 0.8,label="25%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0.25, na.rm = TRUE)-0.5, y = 1000, size=3,label = paste("25%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0.25, na.rm = TRUE), 2)),color="violetred2")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0.5,na.rm=TRUE),
             linetype = "dashed", color = "turquoise2", size = 0.8,label="50%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0.5, na.rm = TRUE), y = 1000, size=3,label = paste("50%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0.5, na.rm = TRUE), 2)),color="turquoise2")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 0.75,na.rm=TRUE),
             linetype = "dashed", color = "purple", size = 0.8,label="75%") +
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 0.75, na.rm = TRUE)+0.4, y = 1000, size=3,label = paste("75%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 0.75, na.rm = TRUE), 2)),color="purple")+
  geom_vline(xintercept = quantile(stu_qqq_SG_filtered$ESCS, 1,na.rm=TRUE),
             linetype = "dashed", color = "orange", size = 0.8,label="100%")+
  annotate("text", x = quantile(stu_qqq_SG_filtered$ESCS, 1, na.rm = TRUE)-0.5, y = 1000, size=3,label = paste("100%: ", round(quantile(stu_qqq_SG_filtered$ESCS, 1, na.rm = TRUE), 2)),color="orange")+
  stat_cor(aes(label = paste(..rr.label..,..p.label.., sep = "~`,`~")),
           label.x = 2.2, label.y = 800, label.size = 4) +
  theme(axis.title.y = element_blank())
```
:::

We then combine the 3 plots into one visualisation using the following code:

```{r,fig.width=10,fig.height=15}
(p15/p16/p17)+
  plot_annotation(tag_levels = "I")
```

From the visualisation above, we can observe the scores are generally positively correlated with the ESCS index. However, based on the R2 values (which were approximately \~0.2), the variation in ESCS index weakly explains the variation in the scores.

Further, it is observed that there are a range of scores within the different quantiles of ESCS index i.e. within the 25th percentile, scores vary between a large range, \~300 to \~800 for Math and Science and \~200 to \~700 for Reading. It would hence be better to explore how the scores would vary across the different levels of ESCS index. To do this, we will explore another form of visualisation in the next section.

### 4.4.4 Supplementary visualisation for performance across different ESCS index values

Given the definition of socio-economically disadvantaged and advantaged which refer to the bottom and top quarter of ESCS in his or her own country/economy, we could bin the ESCS index values.

This would allow us to study the distribution of scores within the ESCS quantiles and additionally counter the issue of having a mass of data points on the plot which might be aesthetically unpleasing, which the earlier remake was unable to tackle.

### 4.4.4.1 Removing missing values and binning variable ESCS

In earlier steps, we observed that there are 47 missing values for the ESCS variable and this is confirmed by the code chunk below:

```{r}
paste("There are",sum(is.na(stu_qqq_SG_filtered$ESCS)),"missing values for ESCS.")
```

As this makes up less than 1% of the dataset, the rows with missing values for ESCS were removed before further analysis.

The code chunk below removes rows with missing values for ESCS:

```{r}
stu_qqq_SG_filtered <- stu_qqq_SG_filtered[complete.cases(stu_qqq_SG_filtered[, "ESCS"]), ]
```

We will bin the ESCS variable into quantiles using the mutate() and cut() function, and the code chunk is as follows:

```{r}
stu_qqq_SG_filtered <- stu_qqq_SG_filtered %>%
  mutate(ESCS_recoded = cut(ESCS,breaks=quantile(ESCS,c(0,0.25,0.5,0.75,1)),labels=c("Quarter 1","Quarter 2","Quarter 3","Quarter 4"),include.lowest=TRUE,na.rm=TRUE))
```

**Quarter 1 refers to the most socio-economically disadvantaged while Quarter 4 refers to the most socio-economically advantaged.**

### 4.4.4.2 Visualisation of performance across different quantiles of ESCS index

The code chunks for the individual plots are as follows:

::: panel-tabset
## Math {.unlisted}

```{r,fig.height=5,fig.width=8}
p18 <- ggplot(data = stu_qqq_SG_filtered,
       aes (x = ESCS_recoded, y = MATH_Score, fill = ESCS_recoded,alpha=0.5))+
  geom_boxplot(notch=TRUE,
               width = 0.1,
               position = position_nudge(x=0.06))+
  stat_halfeye(adjust = 0.5,
               width = 0.6,
               justification = -0.3,
               .width = 0,
               point_colour = NA,
               position = "dodge",
               scale=0.9) +
  stat_dots(side = "left", 
            justification = 1, 
            binwidth = .5,
            dotsize = 10) +
  stat_summary(geom = "point", fun.y= "mean", colour ="black", size=1,position=position_nudge(x=0.06))+
  labs(title = "Math Scores by ESCS quantiles",
       y = "Math Score",
       x = "ESCS quantiles")+
  theme_hc(base_size=10)+
  theme(legend.position = "right",aspect.ratio = 1/2)+
  guides(alpha="none")+
  coord_cartesian(ylim = c(0, 1000))+
  scale_y_continuous(limits = c(0,1000),breaks = seq(0, 1000, by = 100))+
  coord_flip()
```

## Reading {.unlisted}

```{r,fig.height=5,fig.width=8}
p19 <- ggplot(data = stu_qqq_SG_filtered,
       aes (x = ESCS_recoded, y = READ_Score, fill = ESCS_recoded,alpha=0.5))+
  geom_boxplot(notch=TRUE,
               width = 0.1,
               position = position_nudge(x=0.06))+
  stat_halfeye(adjust = 0.5,
               width = 0.6,
               justification = -0.3,
               .width = 0,
               point_colour = NA,
               position = "dodge",
               scale=0.9) +
  stat_dots(side = "left", 
            justification = 1, 
            binwidth = .5,
            dotsize = 10) +
  stat_summary(geom = "point", fun.y= "mean", colour ="black", size=1,position=position_nudge(x=0.06))+
  labs(title = "Reading Scores by ESCS quantiles",
       y = "Reading Score",
       x = "ESCS quantiles")+
  theme_hc(base_size=10)+
  theme(legend.position = "right",aspect.ratio = 1/2)+
  guides(alpha="none")+
  coord_cartesian(ylim = c(0, 1000))+
  scale_y_continuous(limits = c(0,1000),breaks = seq(0, 1000, by = 100))+
  coord_flip()
```

## Science {.unlisted}

```{r,fig.height=5,fig.width=8}
p20 <- ggplot(data = stu_qqq_SG_filtered,
       aes (x = ESCS_recoded, y = SCIE_Score, fill = ESCS_recoded,alpha=0.5))+
  geom_boxplot(notch=TRUE,
               width = 0.1,
               position = position_nudge(x=0.06))+
  stat_halfeye(adjust = 0.5,
               width = 0.6,
               justification = -0.3,
               .width = 0,
               point_colour = NA,
               position = "dodge",
               scale=0.9) +
  stat_dots(side = "left", 
            justification = 1, 
            binwidth = .5,
            dotsize = 10) +
  stat_summary(geom = "point", fun.y= "mean", colour ="black", size=1,position=position_nudge(x=0.06))+
  labs(title = "Science Scores by ESCS quantiles",
       y = "Science Score",
       x = "ESCS quantiles")+
  theme_hc(base_size=10)+
  theme(legend.position = "right",aspect.ratio = 1/2)+
  guides(alpha="none")+
  coord_cartesian(ylim = c(0, 1000))+
  scale_y_continuous(limits = c(0,1000),breaks = seq(0, 1000, by = 100))+
  coord_flip()
```
:::

We then combine the 3 visualisations using the following code chunk:

```{r,fig.height=10,fig.width=8}
(p18/p19/p20)+
  plot_annotation(tag_levels = "I")
```

This visualisation not only indicates the general positive relationship scores have with ESCS index - the scores increase with the increasingly socio-economically advantaged i.e. higher scores are observed for Quarter 4 and lower scores are observed for the lower quarters, for all 3 subjects - it also shows the spread of performance within each ESCS quantile. For instance, for Math and Reading, the density plot for Quarter 1 is skewed more towards the left (lower scores) as compared to Quarters 2 to 4 which are skewed more towards the right. This is less obvious from the distribution of Science scores where Quarter 1 has a seemingly more normal distribution. This indicates that students that are more socio-economically disadvantaged are more affected in terms of Math and Reading. However, this would require further investigation to determine if the observation is significant.

Overall, this remake does counter the negative points of the original visualisation, it is more aesthetically pleasing without the clutter of the data points and clearer and more granular in indicating the distribution of performance by ESCS index.

# 5. References

-   [PISA 2022 Database](https://www.oecd.org/pisa/data/2022database/)

-   [PISA 2022 Definitions](https://gpseducation.oecd.org/content/notes/definitions_pisa_gps.pdf)

-   [PISA 2022 Results (Volume I)](https://www.oecd-ilibrary.org/sites/53f23881-en/index.html?itemId=/content/publication/53f23881-en#:~:text=Singapore%20scored%20significantly%20higher%20than,countries%20and%20economies%20in%20mathematics.)

-   [Notched box plots](https://help.xlstat.com/6589-notched-box-plots-tutorial-excel#:~:text=Interpreting%20notched%20box%20plots&text=The%20red%20crosses%20correspond%20to,are%20different%20from%20one%20another.)

---
title: "Visual Analytics Project - CDA Prototype"
date: "March 1, 2024"
date-modified: "last-modified"
toc: true
execute:
  eval: true
  echo: true
  freeze: true
  warning: false
  message: false
editor: visual
---

## 1. About the Project

My project group [StormTroopers](https://vaastormtroopers.netlify.app/proposal/proposal) is working on the topic of climate change.

As a small, low-lying city-state, Singapore is vulnerable to the effects of climate change which has brought about more extreme weather patterns - rising sea levels, dry spells and intense rainfall which at times can lead to flash floods.

![](images/clipboard-939414320.png)

According to an [infographic](https://www.nccs.gov.sg/singapores-climate-action/impact-of-climate-change-in-singapore/) above by the National Climate Change Secretariat Singapore:

1.  Daily mean temperatures are projected to increase by 1.4 to 4.6 degrees celsius; and
2.  The contrast between the wet months (November to January) and dry months (February and June to September) is likely to be more pronounced.

In Jan 2024, the Centre for Climate Research Singapore (CCRS) announced the [Third National Climate Change Study (V3)](https://www.mss-int.sg/v3-climate-projections) which provided potential scenarios of our future based on low, medium, and high global greenhouse gas emissions.

1.  Very hot days will become more frequent.
2.  Extreme daily rainfall is projected to intensify.
3.  The mean sea level around Singapore is projected to rise up to 1.15m by end century, and up to around 2m by 2150 under the high emissions scenario.

It is important that we better understand how climate change has been affecting Singapore, by understanding the trends in our daily temperatures and rainfall over the years, and utilise historical data to forecast future climate data. It will provide guidance on whether and how Singapore will need to urgently develop ways to mitigate and adapt.

### 1.1 Issues to address

The scope I am in charge of is Confirmatory Data Analysis which seeks to address the following issues:

-   Are the changes in rainfall and temperature over the years statistically significant? 

-   Are there really certain months “drier” or “wetter”/ “hotter” or “cooler”?

-   Are there certain locations “drier” or “wetter”/ “hotter” or “cooler”?

## 2. The Data

For this take-home exercise and the project, data utilised is the historical climate data from [Metrological Service Singapore](http://www.weather.gov.sg/climate-historical-daily).

The team downloaded historical daily records from various weather stations across Singapore from 1980 to 2023 via API scrapping as a *daily_historical.csv* datafile, which was subsequently processed to *weather_data_imputed.rds.*

## 3. Set-up

### 3.1 Installing and loading the required libraries

The following code chunk is used to install the necessary R packages:

```{r}
pacman::p_load(tidyverse,ggridges,ggrepel,ggthemes,ggstatsplot,ggsignif,hrbrthemes,patchwork,dplyr, gifski, gapminder,plotly,gganimate,ggiraph,magick,car)
```

### 3.2 Importing the Dataset

```{r}
weather_data <- read_rds("data/weather_data_imputed.rds")

glimpse(weather_data)

DT::datatable(weather_data)
```

As can be seen, there are a total of 1548 records across 6 variables:

-   station

-   tdate

-   mean_monthly_temperature

-   min_monthly_temperature

-   max_monthly_temperature

-   monthly_rainfalls

### 3.3 Data Cleaning

#### **3.3.1 Check for missing values**

```{r}
sum(is.na(weather_data))
```

#### **3.3.2 Ensuring alignment in time period of records across weather stations**

::: panel-tabset
## Starting Year

```{r}
weather_data_start <- weather_data %>% 
  group_by(station) %>% 
  mutate(year=year(lubridate::ymd(tdate))) %>%
  summarise(earliest_year = min(year))

weather_data_start
```

## Ending Year

```{r}
weather_data_end <- weather_data %>%
  group_by(station) %>%
  mutate(year=year(lubridate::ymd(tdate))) %>%
  summarise(latest_year = max(year))

weather_data_end
```
:::

The starting and ending year of weather data across all 13 weather stations is 2014 and 2023 respectively, no further steps are required to align the time period of the data.

#### **3.3.3 Detailed dataset - adding year and month columns - for ease of analysis**

For ease of analysis, the tdate in *weather_data* was further broken down into year and month and added as columns to *weather_data_detailed:*

```{r}
weather_data_detailed <- weather_data %>%
  mutate(year=year(lubridate::ymd(tdate))) %>%
  mutate(month=month(lubridate::ymd(tdate)))

glimpse(weather_data_detailed)
```

Saving it as a csv file for analysis:

```{r}
#| eval: false
write_csv(weather_data_detailed, "data/weather_data_detailed.csv")
```

## 4. Confirmatory Data Analysis (CDA)

## 4.1 CDA #1 - Are the changes in rainfall and temperature over the years statistically significant? 

The first CDA that I will address is whether changes in rainfall and temperature over the years are statistically significant

As the data ranges from 2014 to 2023, there are 10 years worth of data.

## 4.1.1 Rainfall

### 4.1.1.1 Historical rainfall over the years

```{r}
rainfall_data_year <- weather_data_detailed %>%
  group_by(station,year) %>%
  summarise(yearly_rainfall = sum(monthly_rainfall))

DT::datatable(rainfall_data_year,class = "compact")
```

Saving it as a csv file:

```{r}
#| eval: false
write_csv(rainfall_data_year, "data/rainfall_data_year.csv")
```

```{r,fig.height=6}
p1 <- ggplot(rainfall_data_year,
             aes(y=yearly_rainfall,
                 x = year,
                 group = station,
                 color = station)) +
  geom_line() +
  facet_wrap(~station,scales = "free_x") +
  labs(title="Yearly rainfall across weather stations from 2014 to 2023",
       y = "Rainfall volume (mm)",
       x = "Year") +
  theme_minimal() +
  theme(axis.text.x=element_text(angle=90,hjust=1),panel.spacing.y = unit(5,"lines") )

ggplotly(p1)
```

Over the years, across the 13 weather stations, the rainfall volume is observed to have increased albeit by different intensities. We need to examine if the differences are statistically different.

Before we do so**,** we will need to determine whether the rainfall for each year follows a normal or non-normal distribution and we visualise the distribution of rainfall using ridgeline plots, using the code chunk below.

### 4.1.1.2 Distribution of Rainfall from 2014 to 2023

```{r,fig.width=30,fig.height=20}
p2 <- ggplot(weather_data_detailed, 
       aes(x = monthly_rainfall,
           y = as.factor(year), 
           fill = 0.5 - abs(0.5-stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", 
                      calc_ecdf = TRUE) +
  scale_fill_viridis_c(name = "Tail probability",
                       direction = -1,
                       option="turbo")+
  facet_wrap(~station) +
  coord_cartesian(xlim = c(0,800)) +
  theme_ridges(font_size = 25)+
  labs(title="Distribution of Monthly Rainfall from 2014 to 2023 (zoomed in)",
       y="Year",
       x="Rainfall Volume (mm)")

p2
```

### 4.1.1.3 Normality Test - Shapiro-Wilk Normality Test

-   **H~0~:** Sample distribution is normal

-   **H~1~:** Sample distribution is non-normal

```{r}
shapiro.test(weather_data_detailed$monthly_rainfall)
```

From the output, the p-value \< 0.05 implying that the distribution of the data is significantly different from normal distribution. In other words, we can assume that the data is non-normal and utilise non-parametric test for CDA analysis.

### 4.1.1.4 Equal Variance Assumption Test

-   **H~0~:** Groups have equal variances

-   **H~1~:** Groups have different variances

```{r}
leveneTest(monthly_rainfall ~ as.factor(year), data = weather_data_detailed)
```

-   From the above result, we can observe that p-value \< 0.05. We have enough evidence to reject the null hypothesis. So the variance across the samples is not equal at 0.05 significance level.

Given the above, a non-parametric test will be utilised:

::: panel-tabset
## Median Rainfall per year

**The hypothesis is as follows:**

*H~0~: There is no difference between median rainfall per year across 10 years.*

*H~1~: There is a difference between median rainfall per year across 10 years.*

```{r,fig.width=12,fig.height=10}
p3 <- ggbetweenstats(
  data = rainfall_data_year,
  x = year, 
  y = yearly_rainfall,
  type = "np",
  pairwise.display = "significant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Rainfall across 10 years (2014 to 2023)",
  ylab = "Rainfall volume (mm)",
  xlab = "Year",
  ggsignif.args = list(textsize = 5)
) +
  theme(text = element_text(size = 20), plot.title=element_text(size=20))

p3
```

The plot above shows p-values of pairwise test that have p-values \< 0.05 and for which the null hypothesis will be rejected at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median rainfall per year between years:

-   2014 with 2021 to 2023

-   2015 with 2020 to 2023

-   2016 with 2021

-   2017 with 2019

-   2019 with 2020 to 2023

**Overall, this indicates that changes in rainfall over the years is statistically significant.**

## Median Rainfall across 10 years (aggregated using monthly rainfall)

**The hypothesis is as follows:**

*H~0~: There is no difference between median rainfall across 10 years.*

*H~1~: There is a difference between median rainfall across 10 years.*

```{r,fig.width=12,fig.height=10}
p4 <- ggbetweenstats(
  data = weather_data_detailed,
  x = year, 
  y = monthly_rainfall,
  type = "np",
  pairwise.display = "significant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Rainfall across 10 years (2014 to 2023)",
  ylab = "Rainfall volume (mm)",
  xlab = "Year",
  ggsignif.args = list(textsize = 5)
) +
  theme(text = element_text(size = 20),plot.title=element_text(size=20))

p4
```

This test shows a more detailed comparison of median rainfall across the 10 years (aggregated at monthly rainfall levels). As seen from the p-values of the test above, which are \< 0.05, we reject the null hypothesis at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median rainfall across the years.
:::

## 4.1.2 Temperature

### 4.1.2.1 Historical temperature over the years

```{r}
temp_year <- weather_data_detailed %>%
  group_by(station,year) %>%
  summarise(median_mean_temp = median(mean_monthly_temperature),
            median_max_temp = median(max_monthly_temperature),
            median_min_temp = median(min_monthly_temperature))

DT::datatable(temp_year,class = "compact")
```

Saving it as a csv file:

```{r}
#| eval: false
write_csv(temp_year, "data/temp_year.csv")
```

::: panel-tabset
## Median Mean Temperature

```{r}
p5 <- ggplot(temp_year,
             aes(y = median_mean_temp,
                 x = year,
                 group = station,
                 color = station)) +
  geom_line()+
  facet_wrap(~station,scales = "free_x") +
  labs(title="Median mean temperature across weather stations from 2014 to 2023",
       y = "Temperature (°C)",
       x = "Year") +
  theme_minimal() +
  theme(axis.text.x=element_text(angle=90,hjust=1))

p5 <- ggplotly(p5, tooltip="all",width = 800,height = 600) %>% 
  layout(width = 800, height = 600)

p5
```

Based on observation, it seems like median mean temperature for each weather station did not undergo significant changes over the years from 2014 to 2023.

## Median Maximum Temperature

```{r}
p6 <- ggplot(temp_year,
             aes(y = median_max_temp,
                 x = year,
                 group = station,
                 color = station)) +
  geom_line() +
  facet_wrap(~station,scales = "free_x") +
  labs(title="Median max temperature across weather stations from 2014 to 2023",
       y = "Temperature (°C)",
       x = "Year") +
  theme_minimal() +
  theme(axis.text.x=element_text(angle=90,hjust=1))

p6 <- ggplotly(p6, tooltip="all",width = 800,height = 600) %>% 
  layout(width = 800, height = 600)

p6
```

Based on observation, it seems like median max temperature for each weather station did not undergo significant changes over the years from 2014 to 2023.

## Median Minimum Temperature

```{r}
p7 <- ggplot(temp_year,
             aes(y = median_min_temp,
                 x = year,
                 group = station,
                 color = station)) +
  geom_line() +
  facet_wrap(~station,scales = "free_x") +
  labs(title="Median min temperature across weather stations from 2014 to 2023",
       y = "Temperature (°C)",
       x = "Year") +
  theme_minimal() +
  theme(axis.text.x=element_text(angle=90,hjust=1))

p7 <- ggplotly(p7, tooltip="all",width = 800,height = 600) %>% 
  layout(width = 800, height = 600)

p7
```

Based on observation, it seems like median minimum temperature for each weather station did not undergo significant changes over the years from 2014 to 2023.
:::

### 4.1.2.2 Distribution of Temperature (Mean, Max and Min) from 2014 to 2023

Likewise, to determine whether the changes in the median mean, median maximum and median minimum temperatures are significant**,** we will need to determine whether the temperature data follows a normal or non-normal distribution. We visualise the distribution using ridgeline plots, using the code chunks below.

::: panel-tabset
## Distribution of Mean Temperature

```{r,fig.width=30,fig.height=20}
p8 <- ggplot(weather_data_detailed, 
       aes(x = mean_monthly_temperature, 
           y = as.factor(year), 
           fill = 0.5 - abs(0.5-stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", 
                      calc_ecdf = TRUE) +
  scale_fill_viridis_c(name = "Tail probability",
                       direction = -1,
                       option="turbo")+
  facet_wrap(~station) + 
  theme_ridges(font_size = 25)+
  labs(title="Distribution of Mean Monthly Temperature from 2014 to 2023",
       y="Year",
       x="Temperature (°C)")

p8
```

As can be seen from the plot above, the distribution of monthly mean temperature for each year is not normal, as such, non-parametric test will be used.

## Distribution of Maximum Temperature

```{r,fig.width=30,fig.height=20}
p9 <- ggplot(weather_data_detailed, 
       aes(x = max_monthly_temperature, 
           y = as.factor(year), 
           fill = 0.5 - abs(0.5-stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", 
                      calc_ecdf = TRUE) +
  scale_fill_viridis_c(name = "Tail probability",
                       direction = -1,
                       option="turbo")+
  facet_wrap(~station) + 
  theme_ridges(font_size = 25)+
  labs(title="Distribution of Monthly Maximum Temperature from 2014 to 2023",
       y="Station",
       x="Temperature (°C)")
p9
```

As can be seen from the plot above, the distribution of monthly maximum temperature for each year is not normal, as such, non-parametric test will be used.

## Distribution of Minimum Temperature

```{r,fig.width=30,fig.height=20}
p10 <- ggplot(weather_data_detailed, 
       aes(x = min_monthly_temperature, 
           y = as.factor(year), 
           fill = 0.5 - abs(0.5-stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", 
                      calc_ecdf = TRUE) +
  scale_fill_viridis_c(name = "Tail probability",
                       direction = -1,
                       option="turbo")+
  facet_wrap(~station) + 
  theme_ridges(font_size = 25)+
  labs(title="Distribution of Monthly Minimum Temperature from 2014 to 2023",
       y="Station",
       x="Temperature (°C)")
p10
```

As can be seen from the plot above, the distribution of monthly minimum temperature for each year is not normal, as such, non-parametric test will be used.
:::

### 4.1.2.3 Normality Test - Shapiro-Wilk Normality Test

-   **H~0~:** Sample distribution is normal

-   **H~1~:** Sample distribution is non-normal

```{r}
shapiro.test(weather_data_detailed$mean_monthly_temperature)
shapiro.test(weather_data_detailed$max_monthly_temperature)
shapiro.test(weather_data_detailed$min_monthly_temperature)
```

From the output, the p-value \< 0.05 implying that the distribution of the data is significantly different from normal distribution. In other words, we can assume that the data is non-normal and utilise non-parametric test for CDA analysis.

### 4.1.2.4 Equal Variance Assumption Test

-   **H~0~:** Groups have equal variances

-   **H~1~:** Groups have different variances

```{r}
leveneTest(mean_monthly_temperature ~ as.factor(year), data = weather_data_detailed)
leveneTest(max_monthly_temperature ~ as.factor(year), data = weather_data_detailed)
leveneTest(min_monthly_temperature ~ as.factor(year), data = weather_data_detailed)
```

-   From the above result, we can observe that p-value \< 0.05. We have enough evidence to reject the null hypothesis. So the variance across the samples is not equal at 0.05 significance level.

Given the above, a non-parametric test will be utilised:

::: panel-tabset
## Median Mean Temperature by year

**The hypothesis is as follows:**

*H~0~: There is no difference between median mean temperature of each year across 10 years.*

*H~1~: There is a difference between median mean temperature of each year across 10 years.*

```{r,fig.width=12,fig.height=10}
p11 <- ggbetweenstats(
  data = temp_year,
  x = year, 
  y = median_mean_temp,
  geom = "box",
  type = "np",
  pairwise.display = "significant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Median Mean Temperature of each year across 10 years (2014 to 2023)",
  ylab = "Temperature (°C)",
  xlab = "Year",
  ggsignif.args = list(textsize = 5)
) +
  theme(text = element_text(size = 20),plot.title=element_text(size=20))
p11

```

The plot above shows p-values of pairwise test that have p-values \< 0.05 and for which the null hypothesis will be rejected at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median mean temperature across the 10 years for:

-   2019 with 2021 and 2022

-   2021 and 2022 with 2023

**Overall, this indicates that changes in mean temperature in the later years from 2019 is statistically significant.**

## Monthly Mean Temperature

**The hypothesis is as follows:**

*H~0~: There is no difference between median monthly mean temperature across 10 years.*

*H~1~: There is a difference between median monthly mean temperature across 10 years.*

```{r,fig.width=12,fig.height=10}
p12 <- ggbetweenstats(
  data = weather_data_detailed,
  x = year, 
  y = mean_monthly_temperature,
  type = "np",
  pairwise.display = "significant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Monthly Mean Temperature across 10 years (2014 to 2023)",
  ylab = "Temperature (°C)",
  xlab = "Year",
  ggsignif.args = list(textsize = 5)
) +
  theme(text = element_text(size = 20),plot.title=element_text(size=20))
p12
```

This test shows a more detailed comparison of median monthly mean temperature across the 10 years. As the p-values of the test above are \< 0.05, we reject the null hypothesis at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median monthly mean temperature across the years.
:::

::: panel-tabset
## Median Max Temperature by year

**The** **hypothesis is as follows:**

*H~0~: There is no difference between median max temperature of each year across 10 years.*

*H~1~: There is a difference between median max temperature of each year across 10 years.*

```{r,fig.width=12,fig.height=10}
p13 <- ggbetweenstats(
  data = temp_year,
  x = year, 
  y = median_max_temp,
  type = "np",
  pairwise.display = "signficant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Median Max Temperature of each year across 10 years (2014 to 2023)",
  ylab = "Temperature (°C)",
  xlab = "Year",
  ggsignif.args = list(textsize = 5)
) +
  theme(text = element_text(size = 20),plot.title=element_text(size=20))
p13
```

The plot above shows that there are no pairwise tests with p-values \< 0.05, we cannot reject the null hypothesis at alpha = 0.05. There is insufficient evidence to indicate that there is a difference in the median max temperature across the years.

## Monthly Max Temperature

**The hypothesis is as follows:**

*H~0~: There is no difference between median monthly max temperature across 10 years.*

*H~1~: There is a difference between median monthly max temperature across 10 years.*

```{r,fig.width=12,fig.height=10}
p14 <- ggbetweenstats(
  data = weather_data_detailed,
  x = year, 
  y = max_monthly_temperature,
  type = "np",
  pairwise.display = "significant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Monthly Max Temperature across 10 years (2014 to 2023)",
  ylab = "Temperature (°C)",
  xlab = "Year",
  ggsignif.args = list(textsize = 5)
) +
  theme(text = element_text(size = 20),plot.title=element_text(size=20))
p14
```

This test shows a more detailed comparison of median monthly max temperature across the 10 years. As the p-values of the test above are \< 0.05, we reject the null hypothesis at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median monthly max temperature for:

-   2014 and 2016

-   2016 and 2022
:::

::: panel-tabset
## Median Min Temperature by year

**The** **hypothesis is as follows:**

*H~0~: There is no difference between median min temperature per year across 10 years.*

*H~1~: There is a difference between median min temperature per year across 10 years.*

```{r,fig.width=12,fig.height=10}
p15 <- ggbetweenstats(
  data = temp_year,
  x = year, 
  y = median_min_temp,
  type = "np",
  pairwise.display = "significant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Median Min Temperature of each year across 10 years (2014 to 2023)",
  ylab = "Temperature (°C)",
  xlab = "Year",
  ggsignif.args = list(textsize = 5)
) +
  theme(text = element_text(size = 20),plot.title=element_text(size=20))
p15
```

The plot above shows p-values of pairwise test that have p-values \< 0.05 and for which the null hypothesis will be rejected at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median min temperature across the years for:

-   2014 with 2016 and 2019

-   2016 with 2022

-   2019 with 2022

**Overall, this indicates that changes in min temperature over the years is statistically significant.**

## Monthly Min Temperature

**The hypothesis is as follows:**

*H~0~: There is no difference between median monthly min temperature across 10 years.*

*H~1~: There is a difference between median monthly min temperature across 10 years.*

```{r,fig.width=12,fig.height=10}
p16 <- ggbetweenstats(
  data = weather_data_detailed,
  x = year, 
  y = min_monthly_temperature,
  type = "np",
  pairwise.display = "significant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Monthly Min Temperature across 10 years (2014 to 2023)",
  ylab = "Temperature (°C)",
  xlab = "Year",
  ggsignif.args = list(textsize = 5)
) +
  theme(text = element_text(size = 20),plot.title=element_text(size=20))
p16
```

This test shows a more detailed comparison of median daily min temperature across the 10 years. As the p-values of the test above are \< 0.05, we reject the null hypothesis at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median monthly min temperature across the years.
:::

## 4.2 CDA #2 - Are there really certain months “drier” or “wetter”/ “hotter” or “cooler”?

## 4.2.1 Rainfall

### 4.2.1.1 Rainfall across different months

```{r}
rainfall_data_month <- weather_data_detailed %>%
  group_by(year,month) %>%
  summarise(total_monthly_rainfall = sum(monthly_rainfall))

DT::datatable(rainfall_data_month,class = "compact")
```

Saving it as a csv file:

```{r}
#| eval: false
write_csv(rainfall_data_month, "data/rainfall_data_month.csv")
```

```{r,fig.width=17,fig.height=15}
p17 <- ggplot(rainfall_data_month,
             aes(y=total_monthly_rainfall,
                 x = as.factor(month),
                 fill = as.factor(year))) +
  geom_bar(stat = "identity")+
  facet_wrap(~year, scales = "free_x") +
  labs(title="Monthly rainfall each year from 2014 to 2023",
       y = "Rainfall volume (mm)",
       x = "Month") +
  theme_minimal()+
  theme(panel.spacing.y = unit(10, "lines"))+
  scale_fill_discrete(name = "Year")

ggplotly(p17)
```

From the above plots, in 2014 and 2015, it can be seen that rainfall volume is higher in the later months of the year however this is less obvious after 2016. Notably, in 2018 and 2021, a higher volume of rainfall was seen in January as compared to December.

A cycle plot can also be used to visualise the monthly trend of rainfall over the years from 2014 to 2023:

::: callout
## Cycle plot

```{r}
hline.data <- rainfall_data_month %>%
  group_by(month) %>%
  summarise(avgvalue = mean(total_monthly_rainfall))
```

```{r}
ggplot() +
  geom_line(data = rainfall_data_month,
            aes(x = year,
                y = total_monthly_rainfall,
                group = month,
                colour = as.factor(month)))+
              geom_hline(aes(yintercept=avgvalue),
                         data=hline.data,
                         linetype=6,
                         colour="red",
                         size=0.5)+
              facet_wrap(~month,scales = "free_x")+
              labs(axis.text.x=element_blank(),
                   title = "Rainfall by month from 2014 to 2023")+
              xlab("")+
              ylab("Rainfall Volume (mm)")+
              theme_tufte(base_family = "Helvetica")+ theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 1))
```
:::

To determine if there are certain months which are drier or wetter, we need to carry out statistical test to determine if there is a significant difference in the rainfall volume across months.

As data is aggregated at the monthly_rainfall level in the starting dataset *weather_data*, we will carry out the test below using non-parametric test however in the Shiny App, users will be given the flexibility to change the test type to parametric, robust or even bayes.

::: panel-tabset
## Median Rainfall across months

**The hypothesis is as follows:**

*H~0~: There is no difference between median rainfall across months.*

*H~1~: There is a difference between median rainfall across months.*

```{r,fig.width=12,fig.height=10}
p18 <- ggbetweenstats(
  data = rainfall_data_month,
  x = month, 
  y = total_monthly_rainfall,
  type = "np",
  messages = FALSE,
  title="Distribution of Median Rainfall across months (2014 to 2023)",
  ylab = "Rainfall volume (mm)",
  xlab = "Month",
  ggsignif.args = list(textsize = 5)
) +
  theme(text = element_text(size = 20), plot.title=element_text(size=20))
p18
```

The plot above shows p-values of pairwise test that have p-values \< 0.05 and for which the null hypothesis will be rejected at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median rainfall across the months for:

-   February with November and December

-   August with November

**Overall, this indicates that the differences in median rainfall across some months are statistically significant, with February being drier than November and December, and August being drier than November.**
:::

## 4.2.2 Temperature

### 4.2.2.1 Temperature across different months

```{r}
temp_month <- weather_data_detailed %>%
  group_by(year,month) %>%
  summarise(median_mean_temp = median(mean_monthly_temperature),
            median_max_temp = median(max_monthly_temperature),
            median_min_temp = median(min_monthly_temperature))

DT::datatable(temp_month,class = "compact")
```

Saving it as a csv file:

```{r}
#| eval: false
write_csv(temp_month, "data/temp_month.csv")

```

::: panel-tabset
## Median Monthly Mean Temperature

```{r,fig.width=15,fig.height=12}
p19 <- ggplot(temp_month,
       aes(y = median_mean_temp,
           x = month,
           colour = as.factor(year))) +
  geom_line()+
  facet_wrap(~year,scales = "free_x") +
  labs(title="Monthly mean temperature from 2014 to 2023",
       y = "Temperature (°C)",
       x = "Year")+
  scale_x_continuous(breaks = 1:12, labels = 1:12)+
  scale_color_discrete(name = "Year")+
  theme_minimal() +
  theme(panel.spacing.y = unit(5,"lines"))

ggplotly(p19)
```

Based on observation, it seems like monthly mean temperature does not differ significantly across months from 2014 to 2023.

## Median Monthly Maximum Temperature

```{r,fig.width=15,fig.height=12}
p20 <- ggplot(temp_month,
       aes(y = median_max_temp,
           x = month,
           colour = as.factor(year))) +
  geom_line()+
  facet_wrap(~year,scales = "free_x") +
  labs(title="Daily max temperature across weather stations from 2014 to 2023",
       y = "Temperature (°C)",
       x = "Year") +
  scale_x_continuous(breaks = 1:12, labels = 1:12)+
  scale_color_discrete(name = "Year") +
  theme_minimal() +
  theme(panel.spacing.y = unit(5,"lines"))

ggplotly(p20)
```

Based on observation, it seems like median daily max temperature does not differ significantly across months over the years from 2014 to 2023.

## Median Monthly Minimum Temperature

```{r,fig.width=15,fig.height=12}
p21 <- ggplot(temp_month,
       aes(y = median_min_temp,
           x = month,
           colour = as.factor(year))) +
  geom_line()+
  facet_wrap(~year,scales = "free_x") +
  labs(title="Daily min temperature across weather stations from 2014 to 2023",
       y = "Temperature (°C)",
       x = "Year") +
  scale_x_continuous(breaks = 1:12, labels = 1:12)+
  scale_color_discrete(name = "Year") +
  theme_minimal() +
  theme(panel.spacing.y = unit(5,"lines"))

ggplotly(p21)
```

Based on observation, it seems like median monthly minimum temperature does not differ significantly across months over the years from 2014 to 2023.
:::

A cycle plot can also be used to visualise the monthly trend of temperature over the years from 2014 to 2023:

::: callout
## Cycle plot

```{r}
hline_mean_temp.data <- temp_month %>%
  group_by(month) %>%
  summarise(avgvalue = mean(median_mean_temp))

hline_max_temp.data <- temp_month %>%
  group_by(month) %>%
  summarise(avgvalue = mean(median_max_temp))

hline_min_temp.data <- temp_month %>%
  group_by(month) %>%
  summarise(avgvalue = mean(median_min_temp))
```

```{r}
ggplot() +
  geom_line(data = temp_month,
            aes(x = year,
                y = median_mean_temp,
                group = month,
                colour = as.factor(month)))+
              geom_hline(aes(yintercept=avgvalue),
                         data=hline_mean_temp.data,
                         linetype=6,
                         colour="red",
                         size=0.5)+
              facet_wrap(~month,scales = "free_x")+
              labs(axis.text.x=element_blank(),
                   title = "Mean temperature by month from 2014 to 2023")+
              xlab("")+
              ylab("Degrees (°C)")+
              scale_color_discrete(name = "Year")+
              theme_tufte(base_family = "Helvetica")+ theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 1))

ggplot() +
  geom_line(data = temp_month,
            aes(x = year,
                y = median_max_temp,
                group = month,
                colour = as.factor(month)))+
              geom_hline(aes(yintercept=avgvalue),
                         data=hline_max_temp.data,
                         linetype=6,
                         colour="red",
                         size=0.5)+
              facet_wrap(~month,scales = "free_x")+
              labs(axis.text.x=element_blank(),
                   title = "Max temperature by month from 2014 to 2023")+
              xlab("")+
              ylab("Degrees (°C)")+
              scale_color_discrete(name = "Year")+
              theme_tufte(base_family = "Helvetica")+ theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 1))

ggplot() +
  geom_line(data = temp_month,
            aes(x = year,
                y = median_min_temp,
                group = month,
                colour = as.factor(month)))+
              geom_hline(aes(yintercept=avgvalue),
                         data=hline_min_temp.data,
                         linetype=6,
                         colour="red",
                         size=0.5)+
              facet_wrap(~month,scales = "free_x")+
              labs(axis.text.x=element_blank(),
                   title = "Min temperature by month from 2014 to 2023")+
              xlab("")+
              ylab("Degrees (°C)")+
              scale_color_discrete(name = "Year")+
              theme_tufte(base_family = "Helvetica")+ theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 1))
```
:::

As data is aggregated at the mean_monthly_temperature, max_monthly_temperature and min_monthly_temperature level in the starting dataset *weather_data*, we will carry out the test below using non-parametric test however in the Shiny App, users will be given the flexibility to change the test type to parametric, robust or even bayes.

::: panel-tabset
## Median mean temperature by month

**The** **hypothesis is as follows:**

*H~0~: There is no difference between median mean temperature across months.*

*H~1~: There is a difference between median mean temperature across months.*

```{r,fig.width=12,fig.height=10}
p22 <- ggbetweenstats(data = temp_month,
                      x = month,
                      y = median_mean_temp,
                      type = "np",
                      pairwise.display = "signficant",
                      conf.level = 0.95,
                      messages = FALSE,
                      title = "Distribution of Median Mean Temperature by month (2014 to 2023)",
                      ylab = "Temperature (C)",
                      xlab = "Month",
                      ggsignif.args = list(textsize =5)) +
  theme(text = element_text(size = 20),plot.title = element_text(size = 20))
p22
```

The plot above shows p-values of pairwise test that have p-values \< 0.05 and for which the null hypothesis will be rejected at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median mean temperature across the months for:

-   January with April to September and November

-   February with May to September and November

-   March with May to August

-   June, July and August with December

**Overall, this indicates that the differences in median mean temperature across months is generally statistically significant. This suggests that mean temperatures are higher during the middle months of the year.**

## Median Max Temperature by month

**The hypothesis is as follows:**

*H~0~: There is no difference between median max temperature across months.*

*H~1~: There is a difference between median max temperature across months.*

```{r,fig.width=12,fig.height=10}
p23 <- ggbetweenstats(data = temp_month,
                      x = month,
                      y = median_max_temp,
                      type = "np",
                      pairwise.display = "signficant",
                      conf.level = 0.95,
                      messages = FALSE,
                      title = "Distribution of Median Max Temperature by month (2014 to 2023)",
                      ylab = "Temperature (C)",
                      xlab = "Month",
                      ggsignif.args = list(textsize =5)) +
  theme(text = element_text(size = 20),plot.title = element_text(size = 20))
p23
```

The plot above shows p-values of pairwise test that have p-values \< 0.05 and for which the null hypothesis will be rejected at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median max temperature across the months for:

-   January, February and March with Jun to September and November

-   April with Jun, July, Aug

-   Jun, July and Aug with December

**Overall, this indicates that the differences in median max temperature across months is generally statistically significant. This suggests that max temperatures are higher during the middle months of the year.**

## Median Min Temperature by month

**The hypothesis is as follows:**

*H~0~: There is no difference between median min temperature across months.*

*H~1~: There is a difference between median min temperature across months.*

```{r,fig.width=12,fig.height=10}
p24 <- ggbetweenstats(data = temp_month,
                      x = month,
                      y = median_min_temp,
                      type = "np",
                      pairwise.display = "significant",
                      conf.level = 0.95,
                      messages = FALSE,
                      title = "Distribution of Median Min Temperature by month (2014 to 2023)",
                      ylab = "Temperature (C)",
                      xlab = "Month",
                      ggsignif.args = list(textsize =5)) +
  theme(text = element_text(size = 20),plot.title = element_text(size = 20))
p24
```

The plot above shows that no pairwise test have p-values \< 0.05. The null hypothesis will not be rejected at alpha = 0.05. There is insufficient evidence to indicate that there is a difference in the median min temperature across the months.

**Overall, this indicates that the differences in median min temperature across months is generally statistically insignificant.**
:::

## 4.3 CDA #3 - Are there certain locations “drier” or “wetter”/ “hotter” or “cooler”?

## 4.3.1 Rainfall

### 4.3.1.1 Rainfall across different weather stations

::: panel-tabset
## Median Yearly Rainfall

**The hypothesis is as follows:**

*H~0~: There is no difference between median yearly rainfall across weather stations.*

*H~1~: There is a difference between median yearly rainfall across weather stations.*

```{r,fig.width=12,fig.height=10}
p25 <- ggbetweenstats(
  data = rainfall_data_year,
  x = station, 
  y = yearly_rainfall,
  type = "np",
  pairwise.display = "significant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Yearly Rainfall by Station",
  ylab = "Rainfall volume (mm)",
  xlab = "Station",
  ggsignif.args = list(textsize = 3)
) +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
        plot.title = element_text(size = 15),
        text = element_text(size = 15))
p25
```

The plot above shows p-values of pairwise test that have p-values \< 0.05 and for which the null hypothesis will be rejected at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median daily rainfall across stations for:

-   Choa Chu Kang (South) with East Coast Parkway

    **Overall, this indicates that the differences in median daily rainfall across stations is generally statistically insignificant except for Choa Chu Kang (South) and East Coast Parkway which vary in degree of dryness/wetness.**
:::

### 4.3.1.2 Temperature across different weather stations

::: panel-tabset
## Median Yearly Mean Temperature

**The** **hypothesis is as follows:**

*H~0~: There is no difference between median yearly mean temperature across weather stations.*

*H~1~: There is a difference between median yearly mean temperature across weather stations.*

```{r,fig.width=12,fig.height=10}
p26 <- ggbetweenstats(
  data = temp_year,
  x = station, 
  y = median_mean_temp,
  type = "np",
  pairwise.display = "significant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Yearly Mean Temperature by Station",
  ylab = "Temperature (°C)",
  xlab = "Station",
  ggsignif.args = list(textsize = 3)
) +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
        plot.title = element_text(size = 15),
        text = element_text(size = 15))
p26
```

The plot above shows p-values of pairwise test that have p-values \< 0.05 and for which the null hypothesis will be rejected at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median yearly mean temperature for stations:

-   Admiralty with Pasir Panjang and Tai Seng

-   Choa Chu Kang (South) and Clementi with Tai Seng

-   East Coast Parkway with Jurong (West) and Newton

-   Jurong (West) with Jurong Island, Pasir Panjang, Sentosa Island, Tai Seng and Tuas South

-   Jurong Island with Newton

-   Newton with Pasir Panjang, Sentosa Island, Tai Seng and Tuas South

**Overall, this indicates that the differences in median yearly mean temperature across stations is generally statistically significant. This suggests that different regions of Singapore are hotter/cooler.**

## Median Yearly Maximum Temperature

**The** **hypothesis is as follows:**

*H~0~: There is no difference between median yearly maximum temperature across weather stations.*

*H~1~: There is a difference between median yearly maximum temperature across weather stations.*

```{r,fig.width=12,fig.height=10}
p27 <- ggbetweenstats(
  data = temp_year,
  x = station, 
  y = median_max_temp,
  type = "np",
  pairwise.display = "significant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Yearly Max Temperature by Station",
  ylab = "Temperature (°C)",
  xlab = "Station",
  ggsignif.args = list(textsize = 3)
) +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
        plot.title = element_text(size = 15),
        text = element_text(size = 15))
p27
```

The plot above shows p-values of pairwise test that have p-values \< 0.05 and for which the null hypothesis will be rejected at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median yearly max temperature for stations:

-   Admiralty with East Coast Parkway, Jurong Island, Pasir Panjang, Tai Seng and Tuas South

-   Ang Mo Kio with Pasir Panjang

-   Changi with East Coast Parkway and Pasir Panjang

-   Choa Chu Kang (South) with East Coast Parkway, Jurong Island, Pasir Panjang, Sentosa Island, Tai Seng and Tuas South

-   Clementi with East Coast Parkway, Jurong Island, Pasir Panjang, Tai Seng and Tuas South

-   East Coast Parkway with Jurong (West) and Newton

-   Jurong (West) with Jurong Island, Pasir Panjang, Tai Seng and Tuas South

-   Newton and Pasir Panjang

**Overall, this indicates that the differences in median yearly max temperature across stations is generally statistically significant. This suggests that different regions of Singapore are hotter/cooler.**

## Median Yearly Minimum Temperature

**The** **hypothesis is as follows:**

*H~0~: There is no difference between median yearly minimum temperature across weather stations.*

*H~1~: There is a difference between median yearly minimum temperature across weather stations.*

```{r,fig.width=12,fig.height=10}
p28 <- ggbetweenstats(
  data = temp_year,
  x = station, 
  y = median_min_temp,
  type = "np",
  pairwise.display = "significant",
  conf.level = 0.95,
  messages = FALSE,
  title="Distribution of Yearly Min Temperature by Station",
  ylab = "Temperature (°C)",
  xlab = "Station",
  ggsignif.args = list(textsize = 3)
) +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
        plot.title = element_text(size = 15),
        text = element_text(size = 15))
p28
```

The plot above shows p-values of pairwise test that have p-values \< 0.05 and for which the null hypothesis will be rejected at alpha = 0.05. There is sufficient evidence to indicate that there is a difference in the median yearly min temperature for stations:

-   Admiralty with East Coast Parkway, Tai Seng and Tuas South

-   Ang Mo Kio with East Coast Parkway

-   Choa Chu Kang (South) with East Coast Parkway

-   Clementi with East Coast Parkway, Tai Seng and Tuas South

-   East Coast Parkway with Jurong (West) and Newton

-   Jurong (West) with Pasir Panjang, Sentosa Island, Tai Seng and Tuas South

-   Newton with Tai Seng

**Overall, this indicates that the differences in median yearly min temperature across stations is generally statistically significant. This suggests that different regions of Singapore are hotter/cooler.**
:::

## 4.4 CDA Summary Table

+-----------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------+
| S/N       | CDA                                                                      | Findings                                                                                                                               |
+===========+==========================================================================+========================================================================================================================================+
| **1.1**   | Are the changes in rainfall over the years statistically significant?    | -   Over the years, across the 13 weather stations, the rainfall volume is observed to have increased albeit by different intensities. |
|           |                                                                          |                                                                                                                                        |
|           |                                                                          | -   Based on statistical tests, changes in yearly rainfall over the years are found to be statistically significant.                   |
+-----------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------+
| **1.2**   | Are the changes in temperature over the years statistically significant? |                                                                                                                                        |
+-----------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------+
| **2.1**   | Are there really certain months “drier” or “wetter”?                     |                                                                                                                                        |
+-----------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------+
| **2.2**   | Are there really certain months “hotter” or “cooler”?                    |                                                                                                                                        |
+-----------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------+
| **3.1**   | Are there certain locations “drier” or “wetter”?                         |                                                                                                                                        |
+-----------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------+
| **3.2**   | Are there certain locations “hotter” or “cooler”?                        |                                                                                                                                        |
+-----------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------+
